spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:fortnite_pronos}
    username: ${DB_USERNAME:fortnite_user}
    password: ${DB_PASSWORD:fortnite_pass}
    driver-class-name: org.postgresql.Driver
    # CONFIGURATION HIKARI OPTIMISÉE POUR ÉCHEC RAPIDE
    hikari:
      # Timeouts optimisés pour développement rapide
      connection-timeout: 3000      # 3s au lieu de 30s par défaut
      validation-timeout: 2000      # 2s pour valider les connexions
      idle-timeout: 300000          # 5 minutes d'inactivité
      max-lifetime: 1800000         # 30 minutes max par connexion
      
      # Pool sizing optimisé pour développement
      maximum-pool-size: 10         # Reasonable pool for dev
      minimum-idle: 2               # 2 connexions minimum
      
      # Health checks et retry
      initialization-fail-timeout: 5000  # 5s avant échec d'initialisation
      connection-test-query: SELECT 1
      
      # Logging pour diagnostic
      leak-detection-threshold: 60000     # Détecter les fuites après 1 minute
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    # CONFIGURATION FLYWAY OPTIMISÉE
    connect-retries: 2              # Seulement 2 tentatives de connexion
    connect-retries-interval: 1     # 1 seconde entre les tentatives
    lock-retry-count: 3             # 3 tentatives pour acquérir le lock
    fail-on-missing-locations: false
  h2:
    console:
      enabled: false                # H2 console disabled in dev - use PostgreSQL tools
  security:
    user:
      name: admin
      password: admin

server:
  port: 8080

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  health:
    redis:
      enabled: false

logging:
  level:
    root: INFO
    com.fortnite.pronos: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG 

fortnite:
  seed:
    enabled: true
    mode: reference
    legacy-enabled: false
    fake-game-enabled: false
    reset: false

ingestion:
  local:
    enabled: true
