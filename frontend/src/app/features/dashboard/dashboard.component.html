<div class="dashboard-container">
  <!-- Live Regions -->
  <div class="live-region" aria-live="polite" id="dashboard-announcements" class="sr-only"></div>
  <div class="live-region" aria-live="assertive" id="dashboard-alerts" class="sr-only"></div>

  <!-- 1. Header -->
  <div class="dashboard-header">
    <div class="welcome-section">
      <h1 class="dashboard-title">
        <mat-icon class="title-icon">dashboard</mat-icon>
        {{ t.t('navigation.dashboard') }}
      </h1>
      <p class="season-info" *ngIf="selectedGame">{{ t.t('dashboard.labels.season') }} 2025 • {{ selectedGame.name }}</p>
    </div>
    <div class="quick-actions">
      <button mat-stroked-button color="accent" (click)="navigateTo('/trades')">
        <mat-icon>swap_horiz</mat-icon> {{ t.t('navigation.trades') }}
      </button>
      <button mat-stroked-button (click)="navigateTo('/teams')">
        <mat-icon>groups</mat-icon> {{ t.t('dashboard.labels.myTeams') }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading" role="status">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>{{ t.t('dashboard.loading') }}</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !isLoading" role="alert">
    <mat-icon class="error-icon">error</mat-icon>
    <h2>{{ t.t('dashboard.errorTitle') }}</h2>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="loadDashboardData()">{{ t.t('dashboard.retry') }}</button>
  </div>

  <!-- Main Content -->
  <ng-container *ngIf="!isLoading && !error">

    <!-- 2. Game Summary (Reference) -->
    <div class="current-game-panel" *ngIf="selectedGame" appRevealOnScroll>
      <div class="game-hero-card" appPremiumInteractions="parallax">
        <div class="hero-content">
          <div class="game-info-primary">
            <div class="game-status-badge" [class.active]="selectedGame.status === 'ACTIVE'">
              <div class="status-dot"></div>
              {{ getGameStatus(selectedGame) }}
            </div>
            <h2 class="game-title">{{ selectedGame.name }}</h2>
            <div class="game-meta">
              <span class="meta-item">
                <mat-icon>calendar_today</mat-icon>
                {{ selectedGame.createdAt | date:(t.currentLanguage === 'fr' ? 'd MMMM y' : 'MMMM d, y') }}
              </span>
              <span class="meta-item" *ngIf="selectedGame.creatorName">
                <mat-icon>admin_panel_settings</mat-icon>
                {{ selectedGame.creatorName }}
              </span>
            </div>
          </div>

          <div class="game-stats-row">
            <div class="hero-stat">
              <div class="stat-value">{{ formatNumber(stats.totalTeams) }}</div>
              <div class="stat-label">{{ t.t('dashboard.labels.teams') }}</div>
            </div>
            <div class="hero-divider"></div>
            <div class="hero-stat">
              <div class="stat-value">{{ formatNumber(stats.totalPlayers) }}</div>
              <div class="stat-label">{{ t.t('dashboard.labels.players') }}</div>
            </div>
            <div class="hero-divider"></div>
            <div class="hero-stat">
              <div class="stat-value">{{ selectedGame.participantCount || 0 }}</div>
              <div class="stat-label">{{ t.t('dashboard.labels.participants') }}</div>
            </div>
          </div>

          <div class="hero-actions">
            <button mat-flat-button color="primary" class="action-btn" (click)="viewGameDetails(selectedGame)">
              <mat-icon>visibility</mat-icon>
              {{ t.t('common.details', 'Détails') }}
            </button>
            <button mat-stroked-button class="action-btn" (click)="navigateTo('/games')">
              <mat-icon>settings</mat-icon>
              {{ t.t('games.manage', 'Gérer') }}
            </button>
          </div>
        </div>
        <div class="hero-decoration">
          <div class="circle-glow"></div>
          <div class="grid-pattern"></div>
        </div>
      </div>
    </div>

    <!-- 3. Key Metrics Row -->
    <div class="stats-overview" appRevealOnScroll>
      <!-- Pro Players -->
      <div class="stat-card" appPremiumInteractions="magnetic" [appTooltip]="t.t('dashboard.tooltips.proPlayers')">
        <div class="stat-icon">
          <mat-icon>person</mat-icon>
        </div>
        <div>
          <div class="stat-value">{{ t.t('dashboard.labels.proPlayers') }}</div>
          <div class="stat-value-highlight">{{ stats.proPlayersCount || 156 }}</div>
        </div>
        <div class="stat-trend positive">
          <mat-icon>trending_up</mat-icon> +12%
        </div>
      </div>

      <!-- Points -->
      <div class="stat-card" appPremiumInteractions="magnetic" [appTooltip]="t.t('dashboard.tooltips.totalPoints')">
        <div class="stat-icon">
          <mat-icon>emoji_events</mat-icon>
        </div>
        <div>
          <div class="stat-value">{{ t.t('dashboard.labels.points') }}</div>
          <div class="stat-value-highlight">{{ formatNumber(stats.totalPoints) }}</div>
        </div>
        <div class="stat-trend positive">
          <mat-icon>trending_up</mat-icon> {{ t.t('dashboard.labels.total') }}
        </div>
      </div>

      <!-- Season Progress -->
      <div class="stat-card" appPremiumInteractions="magnetic" [appTooltip]="t.t('dashboard.tooltips.seasonProgress')">
        <div class="stat-icon">
          <mat-icon>timelapse</mat-icon>
        </div>
        <div>
          <div class="stat-value">{{ t.t('dashboard.labels.season') }}</div>
          <div class="stat-value-highlight">{{ stats.seasonProgress }}%</div>
        </div>
        <div class="stat-trend neutral">
          {{ t.t('dashboard.labels.progress2025') }}
        </div>
      </div>
    </div>

    <!-- 4. Analytical Grid (Charts + Leaderboard) -->
    <div class="dashboard-content-grid" appRevealOnScroll>
      <!-- Left Column: Charts -->
      <div class="charts-column">
        <!-- Region Chart -->
        <div class="chart-card">
          <div class="card-header">
            <h3><mat-icon>public</mat-icon> {{ t.t('dashboard.charts.regionTitle') }}</h3>
            <p>{{ t.t('dashboard.charts.regionDesc') }}</p>
          </div>
          <div class="chart-container">
            <canvas #regionChart></canvas>
          </div>
        </div>

        <!-- Top 10 Chart -->
        <div class="chart-card">
          <div class="card-header">
            <h3><mat-icon>bar_chart</mat-icon> {{ t.t('dashboard.charts.top10Title') }}</h3>
            <p>{{ t.t('dashboard.charts.performanceByPoints') }}</p>
          </div>
          <div class="chart-container">
            <canvas #pointsChart></canvas>
          </div>
        </div>
      </div>

      <!-- Right Column: Leaderboard -->
      <div class="leaderboard-column">
        <div class="leaderboard-preview">
          <div class="card-header">
            <h3><mat-icon>leaderboard</mat-icon> {{ t.t('navigation.leaderboard') }}</h3>
            <p>{{ t.t('dashboard.labels.currentTop5') }}</p>
          </div>
          <div class="leaderboard-list">
            <div class="leaderboard-header-row">
              <div>{{ t.t('dashboard.labels.rank') }}</div>
              <div>{{ t.t('dashboard.labels.team') }}</div>
              <div style="text-align: right">{{ t.t('dashboard.labels.points') }}</div>
            </div>
            <div class="leaderboard-item" *ngFor="let team of dashboardLeaderboard" [class.rank-1]="team.rank === 1"
              [class.rank-2]="team.rank === 2" [class.rank-3]="team.rank === 3">
              <div class="rank-badge">{{ team.rank }}</div>
              <div class="team-info">
                <span class="team-name">{{ team.name }}</span>
              </div>
              <div class="team-points">{{ formatNumber(team.points) }}</div>
            </div>
          </div>
          <mat-card-actions>
            <button mat-button (click)="navigateTo('/leaderboard')">
              {{ t.t('dashboard.labels.viewFullLeaderboard') }} <mat-icon>arrow_forward</mat-icon>
            </button>
          </mat-card-actions>
        </div>
      </div>
    </div>

    <!-- 5. Navigation -->
    <section class="gaming-navigation">
      <div class="section-header">
        <h2>{{ t.t('dashboard.headings.centralNavigation') }}</h2>
        <p>{{ t.t('dashboard.headings.navigationHint') }}</p>
      </div>
      <div class="navigation-grid">
        <div class="nav-card games-card premium-nav-card" (click)="navigateTo('/games')"
          appPremiumInteractions="magnetic">
          <div class="nav-card-icon"><mat-icon>sports_esports</mat-icon></div>
          <div class="nav-card-content">
            <h3 class="nav-card-title">{{ t.t('games.myGames') }}</h3>
            <p class="nav-card-desc">{{ t.t('dashboard.navCards.gamesDesc') }}</p>
          </div>
        </div>
        <div class="nav-card leaderboard-card premium-nav-card" (click)="navigateTo('/leaderboard')"
          appPremiumInteractions="magnetic">
          <div class="nav-card-icon"><mat-icon>emoji_events</mat-icon></div>
          <div class="nav-card-content">
            <h3 class="nav-card-title">{{ t.t('navigation.leaderboard') }}</h3>
            <p class="nav-card-desc">{{ t.t('dashboard.navCards.leaderboardDesc') }}</p>
          </div>
        </div>
        <div class="nav-card teams-card premium-nav-card" (click)="navigateTo('/teams')"
          appPremiumInteractions="magnetic">
          <div class="nav-card-icon"><mat-icon>groups</mat-icon></div>
          <div class="nav-card-content">
            <h3 class="nav-card-title">{{ t.t('navigation.teams') }}</h3>
            <p class="nav-card-desc">{{ t.t('dashboard.navCards.teamsDesc') }}</p>
          </div>
        </div>
        <div class="nav-card trades-card premium-nav-card" (click)="navigateTo('/trades')"
          appPremiumInteractions="magnetic">
          <div class="nav-card-icon"><mat-icon>swap_horiz</mat-icon></div>
          <div class="nav-card-content">
            <h3 class="nav-card-title">{{ t.t('navigation.trades') }}</h3>
            <p class="nav-card-desc">{{ t.t('dashboard.navCards.tradesDesc') }}</p>
          </div>
        </div>
      </div>
    </section>

  </ng-container>

  <!-- No Game State -->
  <div class="quick-actions-no-games" *ngIf="!isLoading && !error && !selectedGame">
    <!-- Keep existing no-game state -->
    <mat-card class="quick-actions-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>rocket_launch</mat-icon>
        <mat-card-title>{{ t.t('dashboard.noGame.title') }}</mat-card-title>
        <mat-card-subtitle>{{ t.t('dashboard.noGame.subtitle') }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-actions>
        <button mat-raised-button color="primary" (click)="navigateTo('/games/create')">{{ t.t('games.createGame') }}</button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
