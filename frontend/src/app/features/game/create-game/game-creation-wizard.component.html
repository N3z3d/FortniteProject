<!-- UX-001: Advanced Game Creation Wizard - Multi-step with smart defaults -->
<div class="game-creation-wizard">

  <!-- Wizard Header -->
  <div class="wizard-header">
    <h1>
      <mat-icon>auto_awesome</mat-icon>
      {{ t.t('games.wizard.title') }}
    </h1>
    <p class="wizard-subtitle">{{ t.t('games.wizard.subtitle') }}</p>
  </div>

  <!-- Multi-step Stepper -->
  <mat-stepper #stepper orientation="horizontal" class="wizard-stepper">

    <!-- STEP 1: Basic Information & Template Selection -->
    <mat-step [stepControl]="basicInfoForm" [label]="t.t('games.wizard.step1Label')">
      <form [formGroup]="basicInfoForm" class="step-form">

        <!-- Template Selection - UX-001 Smart Defaults -->
        <div class="template-selection">
          <h3>
            <mat-icon>dashboard_customize</mat-icon>
            {{ t.t('games.wizard.chooseTemplate') }}
          </h3>
          <p class="template-hint">{{ t.t('games.wizard.templateHint') }}</p>

          <!-- Popular Templates -->
          <div class="templates-grid">
            <mat-card
              *ngFor="let template of getPopularTemplates()"
              class="template-card"
              [class.selected]="selectedTemplate?.id === template.id"
              (click)="onTemplateSelect(template)">

              <mat-card-header>
                <mat-icon mat-card-avatar [class.popular]="template.popular">
                  {{ template.icon }}
                </mat-icon>
                <mat-card-title>{{ template.name }}</mat-card-title>
                <mat-card-subtitle *ngIf="template.popular" class="popular-badge">
                  <mat-icon>star</mat-icon> {{ t.t('games.wizard.popular') }}
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <p>{{ template.description }}</p>
                <div class="template-specs">
                  <span class="spec">{{ template.config.maxParticipants }} {{ t.t('games.wizard.players') }}</span>
                  <span class="spec">{{ (template.config.draftTimeLimit || 0) / 60 }}{{ t.t('games.wizard.minPerPick') }}</span>
                  <span class="spec" *ngIf="template.config.isPrivate">{{ t.t('games.wizard.private') }}</span>
                  <span class="spec" *ngIf="!template.config.isPrivate">{{ t.t('games.wizard.public') }}</span>
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Other Templates -->
          <details class="other-templates" *ngIf="getAllTemplates().length > getPopularTemplates().length">
            <summary>{{ t.t('games.wizard.otherTemplates') }}</summary>
            <div class="templates-grid">
              <ng-container *ngFor="let template of getAllTemplates()">
                <mat-card
                  *ngIf="!template.popular"
                  class="template-card"
                  [class.selected]="selectedTemplate?.id === template.id"
                  (click)="onTemplateSelect(template)">

                  <mat-card-header>
                    <mat-icon mat-card-avatar>{{ template.icon }}</mat-icon>
                    <mat-card-title>{{ template.name }}</mat-card-title>
                  </mat-card-header>

                  <mat-card-content>
                    <p>{{ template.description }}</p>
                  </mat-card-content>
                </mat-card>
              </ng-container>
            </div>
          </details>
        </div>

        <!-- Game Name and Description -->
        <div class="basic-info-section">
          <h3>
            <mat-icon>edit</mat-icon>
            {{ t.t('games.wizard.gameDetails') }}
          </h3>

          <!-- Real-time validation feedback - UX-001 requirement -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ t.t('games.wizard.gameName') }}</mat-label>
            <input
              matInput
              formControlName="name"
              [placeholder]="t.t('games.wizard.gameNamePlaceholder')"
              maxlength="50"
              autocomplete="off">
            <mat-hint align="end">{{ basicInfoForm.get('name')?.value?.length || 0 }}/50</mat-hint>
            <mat-error>{{ getNameValidationMessage() }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ t.t('games.wizard.descriptionOptional') }}</mat-label>
            <textarea
              matInput
              formControlName="description"
              [placeholder]="t.t('games.wizard.descriptionPlaceholder')"
              rows="3"
              maxlength="200"></textarea>
            <mat-hint align="end">{{ basicInfoForm.get('description')?.value?.length || 0 }}/200</mat-hint>
          </mat-form-field>
        </div>

        <!-- Step Navigation -->
        <div class="step-actions">
          <button mat-button type="button" (click)="onCancel()">
            <mat-icon>close</mat-icon>
            {{ t.t('games.wizard.cancel') }}
          </button>
          <button
            mat-raised-button
            color="primary"
            matStepperNext
            [disabled]="!isStep1Valid()"
            class="next-button">
            <mat-icon>arrow_forward</mat-icon>
            {{ t.t('games.wizard.gameRules') }}
          </button>
        </div>
      </form>
    </mat-step>

    <!-- STEP 2: Player Rules & Configuration -->
    <mat-step [stepControl]="rulesForm" [label]="t.t('games.wizard.step2Label')">
      <form [formGroup]="rulesForm" class="step-form">

        <h3>
          <mat-icon>settings</mat-icon>
          {{ t.t('games.wizard.gameConfig') }}
        </h3>
        <p class="step-description">
          {{ t.t('games.wizard.adjustParams') }}
        </p>

        <!-- Players Configuration -->
        <div class="config-section">
          <h4>{{ t.t('games.wizard.participants') }}</h4>

          <mat-form-field appearance="outline">
            <mat-label>{{ t.t('games.wizard.maxParticipantsLabel') }}</mat-label>
            <mat-select formControlName="maxParticipants">
              <mat-option *ngFor="let num of [2,3,4,5,6,7,8,9,10,12,15,20]" [value]="num">
                {{ num }} {{ t.t('games.wizard.players') }}
              </mat-option>
            </mat-select>
            <mat-hint>{{ t.t('games.wizard.participantsRecommendation') }}</mat-hint>
            <mat-error>{{ getParticipantsValidationMessage() }}</mat-error>
          </mat-form-field>
        </div>

        <!-- Draft Configuration -->
        <div class="config-section">
          <h4>{{ t.t('games.wizard.draftConfig') }}</h4>

          <div class="draft-config">
            <!-- Draft Time Limit -->
            <mat-form-field appearance="outline" class="time-field">
              <mat-label>{{ t.t('games.wizard.timePerPick') }}</mat-label>
              <mat-select formControlName="draftTimeLimit">
                <mat-option [value]="60">{{ t.t('games.wizard.oneMinute') }}</mat-option>
                <mat-option [value]="120">{{ t.t('games.wizard.twoMinutes') }}</mat-option>
                <mat-option [value]="180">{{ t.t('games.wizard.threeMinutesRec') }}</mat-option>
                <mat-option [value]="300">{{ t.t('games.wizard.fiveMinutes') }}</mat-option>
                <mat-option [value]="600">{{ t.t('games.wizard.tenMinutes') }}</mat-option>
                <mat-option [value]="900">{{ t.t('games.wizard.fifteenMinutes') }}</mat-option>
              </mat-select>
              <mat-hint>{{ getDraftTimeLimitLabel() }}</mat-hint>
            </mat-form-field>

            <!-- Auto-pick Delay -->
            <mat-form-field appearance="outline" class="time-field">
              <mat-label>{{ t.t('games.wizard.autoPickDelay') }}</mat-label>
              <mat-select formControlName="autoPickDelay">
                <mat-option [value]="300">{{ t.t('games.wizard.fiveMinutesFast') }}</mat-option>
                <mat-option [value]="1800">{{ t.t('games.wizard.thirtyMinutes') }}</mat-option>
                <mat-option [value]="3600">{{ t.t('games.wizard.oneHourRec') }}</mat-option>
                <mat-option [value]="7200">{{ t.t('games.wizard.twoHours') }}</mat-option>
                <mat-option [value]="43200">{{ t.t('games.wizard.twelveHours') }}</mat-option>
                <mat-option [value]="86400">{{ t.t('games.wizard.twentyFourHours') }}</mat-option>
              </mat-select>
              <mat-hint>{{ getAutoPickDelayLabel() }}</mat-hint>
            </mat-form-field>
          </div>
        </div>

        <!-- Game Options -->
        <div class="config-section">
          <h4>{{ t.t('games.wizard.gameOptions') }}</h4>

          <div class="game-options">
            <mat-checkbox formControlName="isPrivate">
              <span class="option-label">{{ t.t('games.wizard.privateGame') }}</span>
              <span class="option-description">{{ t.t('games.wizard.privateGameDesc') }}</span>
            </mat-checkbox>

            <mat-checkbox formControlName="autoStartDraft">
              <span class="option-label">{{ t.t('games.wizard.autoStartDraft') }}</span>
              <span class="option-description">{{ t.t('games.wizard.autoStartDraftDesc') }}</span>
            </mat-checkbox>
          </div>
        </div>

        <!-- Step Navigation -->
        <div class="step-actions">
          <button mat-button matStepperPrevious>
            <mat-icon>arrow_back</mat-icon>
            {{ t.t('games.wizard.back') }}
          </button>
          <button
            mat-raised-button
            color="primary"
            matStepperNext
            [disabled]="!isStep2Valid()"
            class="next-button">
            <mat-icon>preview</mat-icon>
            {{ t.t('games.wizard.preview') }}
          </button>
        </div>
      </form>
    </mat-step>

    <!-- STEP 3: Review & Preview -->
    <mat-step [label]="t.t('games.wizard.step3Label')">
      <div class="review-step">

        <h3>
          <mat-icon>visibility</mat-icon>
          {{ t.t('games.wizard.previewTitle') }}
        </h3>
        <p class="review-description">
          {{ t.t('games.wizard.previewDesc') }}
        </p>

        <!-- Game Preview Card -->
        <mat-card class="game-preview-card">
          <mat-card-header>
            <mat-icon mat-card-avatar class="game-icon">{{ selectedTemplate?.icon || 'sports_esports' }}</mat-icon>
            <mat-card-title>{{ getGamePreview().name }}</mat-card-title>
            <mat-card-subtitle>{{ selectedTemplate?.name }} â€¢ {{ getGamePreview().estimatedDuration }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <p class="game-description" *ngIf="getGamePreview().description">
              {{ getGamePreview().description }}
            </p>

            <!-- Game Stats -->
            <div class="game-stats">
              <div class="stat">
                <mat-icon>group</mat-icon>
                <span class="stat-label">{{ getGamePreview().maxParticipants }} {{ t.t('games.wizard.participantsMax') }}</span>
              </div>

              <div class="stat">
                <mat-icon>schedule</mat-icon>
                <span class="stat-label">{{ getDraftTimeLimitLabel() }}</span>
              </div>

              <div class="stat">
                <mat-icon>auto_mode</mat-icon>
                <span class="stat-label">{{ t.t('games.wizard.autoPick') }} {{ getAutoPickDelayLabel() }}</span>
              </div>

              <div class="stat" *ngIf="getGamePreview().isPrivate">
                <mat-icon>lock</mat-icon>
                <span class="stat-label">{{ t.t('games.wizard.privateGame') }}</span>
              </div>

              <div class="stat" *ngIf="!getGamePreview().isPrivate">
                <mat-icon>public</mat-icon>
                <span class="stat-label">{{ t.t('games.wizard.publicGame') }}</span>
              </div>
            </div>

            <!-- Success Prediction -->
            <div class="success-prediction">
              <mat-icon class="prediction-icon">psychology</mat-icon>
              <div class="prediction-content">
                <strong>{{ t.t('games.wizard.successPrediction') }}</strong>
                <p>{{ t.t('games.wizard.optimalConfigBased').replace('{n}', getGamePreview().maxParticipants) }}</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Error Display -->
        <mat-card class="error-card" *ngIf="error">
          <mat-card-content>
            <div class="error-content">
              <mat-icon>error</mat-icon>
              <span>{{ error }}</span>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Final Actions -->
        <div class="step-actions final-actions">
          <button mat-button matStepperPrevious [disabled]="loading">
            <mat-icon>arrow_back</mat-icon>
            {{ t.t('games.wizard.modify') }}
          </button>

          <button
            mat-raised-button
            color="primary"
            (click)="onSubmit()"
            [disabled]="loading"
            class="create-button">
            <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!loading">rocket_launch</mat-icon>
            {{ loading ? t.t('games.wizard.creating') : t.t('games.wizard.createGame') }}
          </button>
        </div>
      </div>
    </mat-step>

  </mat-stepper>

  <!-- Progress Indicator -->
  <div class="wizard-progress" *ngIf="!loading">
    <div class="progress-info">
      <mat-icon>info</mat-icon>
      <span>{{ t.t('games.wizard.avgCreationTime') }}</span>
    </div>
  </div>

</div>
