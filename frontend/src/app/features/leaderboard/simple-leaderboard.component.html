<div class="leaderboard-container">
  <!-- Skip to main content link -->
  <a href="#main-content" class="skip-link sr-only-focusable">{{ t.t('leaderboard.skipToContent') }}</a>

  <header role="banner">
    <h1 id="main-heading">{{ t.t('leaderboard.title') }}</h1>
  </header>

  <!-- Loading -->
  <div *ngIf="loading" class="loading" role="status" aria-live="polite" aria-labelledby="loading-text">
    <span id="loading-text">{{ t.t('leaderboard.loading') }}</span>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error" role="alert" aria-live="assertive" aria-labelledby="error-heading">
    <h2 id="error-heading">{{ t.t('leaderboard.errorTitle') }}</h2>
    <p id="error-message">{{ error }}</p>
    <button (click)="loadData()" [attr.aria-label]="t.t('leaderboard.retry')" aria-describedby="error-message">{{ t.t('leaderboard.retry') }}</button>
  </div>

  <!-- Empty Leaderboard State -->
  <div *ngIf="!loading && !error && filteredPlayers.length === 0" class="no-game-selected" role="status" aria-live="polite">
    <div class="empty-state-icon">Œî</div>
    <h2>{{ t.t('leaderboard.noData') }}</h2>
    <p>{{ t.t('leaderboard.noDataDesc') }}</p>
    <button class="cta-button" (click)="loadData()" [attr.aria-label]="t.t('leaderboard.reload')">
      <span>{{ t.t('leaderboard.reload') }}</span>
      <span aria-hidden="true">‚Üª</span>
    </button>
  </div>
  <!-- Main Content -->
  <main id="main-content" *ngIf="!loading && !error && filteredPlayers.length > 0" class="main-content">
    
    <!-- Search and Filters -->
    <section class="controls" aria-labelledby="filters-heading">
      <h2 id="filters-heading" class="sr-only">{{ t.t('leaderboard.filtersHeading') }}</h2>
      <label for="search-input" class="sr-only">{{ t.t('leaderboard.searchLabel') }}</label>
      <input
        id="search-input"
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterPlayers()"
        [placeholder]="t.t('leaderboard.searchPlaceholder')"
        class="search-input"
        [attr.aria-label]="t.t('leaderboard.searchLabel')"
        role="searchbox">

      <label for="region-select" class="sr-only">{{ t.t('leaderboard.region') }}</label>
      <select id="region-select" [(ngModel)]="selectedRegion" (change)="filterPlayers()" class="region-select" [attr.aria-label]="t.t('leaderboard.region')">
        <option value="">{{ t.t('leaderboard.allRegions') }}</option>
        <option value="EU">{{ t.t('leaderboard.regions.EU') }}</option>
        <option value="NAW">{{ t.t('leaderboard.regions.NAW') }}</option>
        <option value="ASIA">{{ t.t('leaderboard.regions.ASIA') }}</option>
        <option value="BR">{{ t.t('leaderboard.regions.BR') }}</option>
        <option value="NAC">{{ t.t('leaderboard.regions.NAC') }}</option>
        <option value="OCE">{{ t.t('leaderboard.regions.OCE') }}</option>
        <option value="ME">{{ t.t('leaderboard.regions.ME') }}</option>
      </select>

      <button (click)="resetFilters()" class="reset-btn" [attr.aria-label]="t.t('leaderboard.resetFilters')">{{ t.t('leaderboard.resetFilters') }}</button>
    </section>

    <!-- Stats -->
    <section class="stats" aria-labelledby="stats-heading">
      <h2 id="stats-heading" class="sr-only">{{ t.t('dashboard.headings.generalStatistics') }}</h2>
      <div class="stat-item" role="group" aria-labelledby="players-count">
        <span class="stat-number" id="players-count-value">{{ filteredPlayers.length }}</span>
        <span class="stat-label" id="players-count">{{ t.t('leaderboard.players') }}</span>
      </div>
      <div class="stat-item" role="group" aria-labelledby="total-points">
        <span class="stat-number" id="total-points-value">{{ getTotalPoints() | number }}</span>
        <span class="stat-label" id="total-points">{{ t.t('leaderboard.totalPoints') }}</span>
      </div>
    </section>
    
    <!-- Podium Top 3 -->
    <section *ngIf="filteredPlayers.length >= 3" class="podium" aria-labelledby="podium-heading">
      <h2 id="podium-heading" class="sr-only">{{ t.t('leaderboard.podiumHeading') }}</h2>

      <div class="podium-item second" role="group" aria-labelledby="second-place" tabindex="0">
        <div class="rank" role="img" [attr.aria-label]="t.t('leaderboard.secondPlace')">2</div>
        <div class="avatar" role="img" [attr.aria-label]="filteredPlayers[1].nickname">{{ getInitials(filteredPlayers[1].nickname) }}</div>
        <div class="name" id="second-place">{{ filteredPlayers[1].nickname }}</div>
        <div class="points" [attr.aria-label]="(filteredPlayers[1].totalPoints | number) + ' ' + t.t('leaderboard.points')">{{ filteredPlayers[1].totalPoints | number }}</div>
      </div>

      <div class="podium-item first" role="group" aria-labelledby="first-place" tabindex="0">
        <div class="rank" role="img" [attr.aria-label]="t.t('leaderboard.firstPlace')">1</div>
        <div class="avatar" role="img" [attr.aria-label]="filteredPlayers[0].nickname">{{ getInitials(filteredPlayers[0].nickname) }}</div>
        <div class="name" id="first-place">{{ filteredPlayers[0].nickname }}</div>
        <div class="points" [attr.aria-label]="(filteredPlayers[0].totalPoints | number) + ' ' + t.t('leaderboard.points')">{{ filteredPlayers[0].totalPoints | number }}</div>
      </div>

      <div class="podium-item third" role="group" aria-labelledby="third-place" tabindex="0">
        <div class="rank" role="img" [attr.aria-label]="t.t('leaderboard.thirdPlace')">3</div>
        <div class="avatar" role="img" [attr.aria-label]="filteredPlayers[2].nickname">{{ getInitials(filteredPlayers[2].nickname) }}</div>
        <div class="name" id="third-place">{{ filteredPlayers[2].nickname }}</div>
        <div class="points" [attr.aria-label]="(filteredPlayers[2].totalPoints | number) + ' ' + t.t('leaderboard.points')">{{ filteredPlayers[2].totalPoints | number }}</div>
      </div>
    </section>
    
    <!-- Players Table -->
    <div class="table-container">
      <table class="players-table" role="table" aria-labelledby="table-caption">
        <caption id="table-caption" class="sr-only">
          {{ t.t('leaderboard.title') }}. {{ filteredPlayers.length }} {{ t.t('leaderboard.players') }}.
        </caption>
        <thead>
          <tr role="row">
            <th scope="col" aria-sort="none" role="columnheader">
              <button class="sort-header" (click)="sortBy('rank')"
                      [attr.aria-label]="t.t('leaderboard.rank')"
                      [attr.aria-pressed]="currentSort === 'rank'">{{ t.t('leaderboard.rank') }}</button>
            </th>
            <th scope="col" role="columnheader">{{ t.t('leaderboard.player') }}</th>
            <th scope="col" role="columnheader">
              <button class="sort-header" (click)="sortBy('region')"
                      [attr.aria-label]="t.t('leaderboard.region')"
                      [attr.aria-pressed]="currentSort === 'region'">{{ t.t('leaderboard.region') }}</button>
            </th>
            <th scope="col" aria-sort="descending" role="columnheader">
              <button class="sort-header" (click)="sortBy('points')"
                      [attr.aria-label]="t.t('leaderboard.points')"
                      [attr.aria-pressed]="currentSort === 'points'">
                {{ t.t('leaderboard.points') }}
              </button>
            </th>
            <th scope="col" role="columnheader">{{ t.t('leaderboard.selectedBy') }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let player of getPaginatedPlayers(); let i = index; trackBy: trackByPlayer" 
              class="player-row" 
              role="row"
              [attr.aria-rowindex]="i + 2"
              [attr.aria-label]="getPlayerRowLabel(player)">
            <td class="rank-cell" role="gridcell">
              <span class="rank-badge" [attr.aria-label]="getRankLabel(player.rank)">{{ player.rank }}</span>
            </td>
            
            <td class="player-cell" role="gridcell">
              <div class="player-info">
                <div class="player-avatar" 
                     role="img" 
                     [attr.aria-label]="getAvatarLabel(player.nickname)">{{ getInitials(player.nickname) }}</div>
                <div class="player-details">
                  <div class="player-nickname">{{ player.nickname }}</div>
                  <div class="player-username">{{ getAtSymbol() }}{{ player.username }}</div>
                </div>
              </div>
            </td>
            
            <td class="region-cell" role="gridcell">
              <span class="region-badge" [attr.aria-label]="getRegionLabel(player.region)">{{ player.region }}</span>
            </td>
            
            <td class="points-cell" role="gridcell">
              <span class="points-value" [attr.aria-label]="getPointsLabel(player.totalPoints)">{{ player.totalPoints | number }}</span>
            </td>

            <td class="prono-cell" role="gridcell">
              <div class="prono-list" *ngIf="player.pronostiqueurs && player.pronostiqueurs.length > 0">
                <span class="prono-badge" *ngFor="let prono of player.pronostiqueurs">{{ prono }}</span>
              </div>
              <span class="no-prono" *ngIf="!player.pronostiqueurs || player.pronostiqueurs.length === 0">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <nav *ngIf="getTotalPages() > 1" class="pagination" role="navigation" [attr.aria-label]="t.t('leaderboard.title')">
      <button
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)"
        class="page-btn"
        [attr.aria-label]="t.t('leaderboard.previous')">
        ‚¨ÖÔ∏è {{ t.t('leaderboard.previous') }}
      </button>

      <span class="page-info" aria-live="polite" aria-atomic="true">{{ getPageOfLabel() }}</span>

      <button
        [disabled]="currentPage === getTotalPages()"
        (click)="goToPage(currentPage + 1)"
        class="page-btn"
        [attr.aria-label]="t.t('leaderboard.next')">
        {{ t.t('leaderboard.next') }} ‚û°Ô∏è
      </button>
    </nav>

    <!-- Empty State -->
    <div *ngIf="filteredPlayers.length === 0" class="empty-state">
      <h3>üòî {{ t.t('leaderboard.noPlayersFound') }}</h3>
      <p>{{ t.t('leaderboard.noPlayersFoundDesc') }}</p>
      <button (click)="resetFilters()" class="reset-btn">{{ t.t('leaderboard.resetFilters') }}</button>
    </div>
    
  </main>
</div>

